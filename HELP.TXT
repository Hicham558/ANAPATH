# ============================================
# FICHIER: .env (Configuration)
# ============================================
DATABASE_URL=postgresql://postgres:B0FeyUxDnYXPWlsm@db.gatiajeraagssxmpaxyo.supabase.co:5432/postgres
FLASK_ENV=production
SECRET_KEY=B0FeyUxDnYXPWlsm

# ============================================
# FICHIER: Procfile (Pour Render/Heroku)
# ============================================
web: gunicorn app:app

# ============================================
# STRUCTURE DU PROJET
# ============================================
anapath/
â”œâ”€â”€ app.py                  # Backend Flask
â”œâ”€â”€ requirements.txt        # DÃ©pendances Python
â”œâ”€â”€ .env                    # Configuration (Ã  ne pas commit)
â”œâ”€â”€ .gitignore             # Fichiers Ã  ignorer
â”œâ”€â”€ Procfile               # Pour dÃ©ploiement
â”œâ”€â”€ README.md              # Documentation
â””â”€â”€ frontend/
    â”œâ”€â”€ index.html         # Page principale
    â”œâ”€â”€ params.html        # Page paramÃ¨tres
    â”œâ”€â”€ selection.html     # SÃ©lection utilisateur
    â””â”€â”€ assets/
        â””â”€â”€ logo.png       # Logo du labo

# ============================================
# CONFIGURATION SUPABASE
# ============================================

# 1. CrÃ©er un projet sur supabase.com
# 2. Obtenir l'URL de connexion PostgreSQL :
#    Settings > Database > Connection String (URI)
# 3. Format : postgresql://postgres.[ref]:[password]@aws-0-[region].pooler.supabase.com:5432/postgres

# Tables SQL Ã  exÃ©cuter dans Supabase SQL Editor :

CREATE TABLE IF NOT EXISTS utilisateurs (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    numero INTEGER UNIQUE,
    nom VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,
    statut VARCHAR(50) DEFAULT 'utilisateur',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_utilisateurs_user_id ON utilisateurs(user_id);

CREATE TABLE IF NOT EXISTS patients (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    nom VARCHAR(255) NOT NULL,
    age INTEGER,
    sexe VARCHAR(1),
    telephone VARCHAR(50),
    adresse TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_patients_user_id ON patients(user_id);

CREATE TABLE IF NOT EXISTS medecins (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    nom VARCHAR(255) NOT NULL,
    specialite VARCHAR(255),
    service VARCHAR(255),
    telephone VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_medecins_user_id ON medecins(user_id);

CREATE TABLE IF NOT EXISTS comptes_rendus (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    numero_enregistrement VARCHAR(100) UNIQUE NOT NULL,
    date_compte_rendu DATE NOT NULL,
    medecin_id INTEGER REFERENCES medecins(id),
    service_hospitalier VARCHAR(255),
    patient_id INTEGER REFERENCES patients(id),
    nature_prelevement TEXT,
    date_prelevement DATE,
    renseignements_cliniques TEXT,
    macroscopie TEXT,
    microscopie TEXT,
    conclusion TEXT,
    statut VARCHAR(50) DEFAULT 'en_cours',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS templates (
    id SERIAL PRIMARY KEY,
    code VARCHAR(50) NOT NULL,           -- Code unique du template
    user_id VARCHAR(255) NOT NULL,       -- PropriÃ©taire du template
    titre VARCHAR(255) NOT NULL,         -- Nom du template
    
    -- Les 4 champs qui remplissent le modal
    renseignements_cliniques TEXT,
    macroscopie TEXT,
    microscopie TEXT,
    conclusion TEXT,
    
    -- MÃ©tadonnÃ©es basiques
    organe VARCHAR(100),                 -- Pour filtrer par organe
    tags TEXT[],                         -- Pour recherche
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- Un template unique par code et utilisateur
    UNIQUE(user_id, code)
);

CREATE INDEX idx_comptes_rendus_user_id ON comptes_rendus(user_id);
CREATE INDEX idx_comptes_rendus_statut ON comptes_rendus(statut);

# ============================================
# DÃ‰PLOIEMENT SUR RENDER.COM
# ============================================

# 1. CrÃ©er compte sur render.com
# 2. New > Web Service
# 3. Connect GitHub repository
# 4. Configuration:
#    - Name: anapath-api
#    - Environment: Python 3
#    - Build Command: pip install -r requirements.txt
#    - Start Command: gunicorn app:app
# 5. Environment Variables:
#    - DATABASE_URL: [URL Supabase]
#    - FLASK_ENV: production
# 6. Deploy!

# ============================================
# CONFIGURATION FRONTEND
# ============================================

# Dans index.html, params.html, selection.html :
# Remplacer "YOUR_FLASK_API_URL" par l'URL de votre API dÃ©ployÃ©e
# Exemple: https://anapath-api.onrender.com

const API_BASE_URL = localStorage.getItem('apiBaseUrl') || 
                     'https://anapath-api.onrender.com';

# ============================================
# TESTS LOCAUX
# ============================================

# Terminal 1 - Backend:
cd anapath
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python app.py

# Terminal 2 - Frontend:
# Ouvrir index.html avec Live Server (VS Code)
# ou
python -m http.server 8000

# AccÃ©der Ã  http://localhost:8000

# ============================================
# SÃ‰CURITÃ‰
# ============================================

# .gitignore:
__pycache__/
*.py[cod]
*$py.class
venv/
.env
*.db
*.log
.DS_Store

# Ã€ NE JAMAIS COMMITER:
# - .env (contient DATABASE_URL)
# - Mots de passe en clair
# - ClÃ©s API

# ============================================
# FONCTIONNALITÃ‰S IMPLÃ‰MENTÃ‰ES
# ============================================

âœ… Gestion Patients (CRUD complet)
âœ… Gestion MÃ©decins demandeurs (CRUD)
âœ… Comptes rendus cyto-pathologiques (CRUD)
âœ… Multi-utilisateurs avec authentification
âœ… SystÃ¨me de permissions (admin/utilisateur)
âœ… GÃ©nÃ©ration PDF des comptes rendus
âœ… Recherche et filtres
âœ… Dashboard avec KPI
âœ… Responsive design
âœ… Mode hors-ligne (localStorage)
âœ… ThÃ¨me adaptÃ© au laboratoire mÃ©dical

# ============================================
# AMÃ‰LIORATIONS FUTURES
# ============================================

ðŸ”œ Signatures Ã©lectroniques
ðŸ”œ Import/Export Excel
ðŸ”œ Historique des modifications
ðŸ”œ Notifications email
ðŸ”œ Statistiques avancÃ©es
ðŸ”œ IntÃ©gration scanner documents
ðŸ”œ Backup automatique
ðŸ”œ API REST documentation (Swagger)

# ============================================
# SUPPORT
# ============================================

Pour toute question:
- Email: support@anapath.dz
- GitHub: https://github.com/votre-repo/anapath
- Documentation: https://d
